name: wannier-berri-org-html

on:
  pull_request:
  push:

jobs:
  build:

    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.9
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install sphinx sphinx-rtd-theme sphinx-pyreverse sphinx_sitemap
        set -ev
        sudo apt-get install pdf2svg
    - name: make
      run: |
        make
    - name: Commit files
      run: |
        rm -r docs/doctrees
        mv  docs/html/* docs
        rm -r docs/html
        git config --global user.name "stepan-tsirkin"
        git config --global user.email "stepan.tsirkin@ehu.eus"

        git add docs
        git commit -m "deployed sphinx"
        git push

